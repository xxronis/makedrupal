#! /bin/bash
# script to build sitebuilder local site
# Run it on your document root like :
# $ makedrupal <foldername> <make.file location> <profile> <host>

if [ ! -n $1 ]; then
	echo -e "\e[00;31mEnter a directory name\e[00m"
elif [ -d $1 ]; then
	echo -e '\E[33;31m'"\033[1mProject allready exists\033[0m"
else
	echo -e "\e[00;32mOpening $1\e[00m"
	mkdir -p $1 && cd $1

	if [ ! -f $2 ]; then
		echo -e "\e[00;31mmake file does not exist\e[00m"
	else
		profile="standard"
		if [ ! -n $3 ]; then
			echo -e "\e[00;32mUsing default profile\e[00m"
		else
			profile=$3
			echo -e "\e[00;32mInstalling using $profile profile\e[00m"
		fi

		# Choose database, host and port and credentials,
		# the database will be named after your installation folder
		db="mysql://developer:enosis21@127.0.0.1:8889"
		if [ ! -n $4 ]; then
			echo -e "\x1B[00;32mUsing default MySql config...\x1B[00m"
		else
			# db=$4
			echo -e "\x1B[00;32mUsing $db configuration...\x1B[00m"
		fi
		drush make -q --working-copy --no-gitinfofile $2 -y
		# Install Drupal
		echo -e "\x1B[00;32mInstalling Drupal...\x1B[00m"
		drush si --account-pass=admin --clean-url=1 --db-url=$db/$1 $profile -y -q

		# Launch website
		echo -e "\x1B[00;32mLaunching your new site...\x1B[00m"
		open http://localhost/$1
	fi
fi
